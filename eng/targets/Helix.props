<Project>

  <Import Project="Helix.Common.props" />

  <ItemDefinitionGroup>
    <HelixContent>
      <CopyToBuildDirectory>Never</CopyToBuildDirectory>
      <CopyToPublishDirectory>Always</CopyToPublishDirectory>
    </HelixContent>
  </ItemDefinitionGroup>

  <PropertyGroup>
    <CreateHelixPayload>true</CreateHelixPayload>
    <HelixTimeout>00:30:00</HelixTimeout>
    <IsWindowsHelixQueue>false</IsWindowsHelixQueue>
    <IsWindowsHelixQueue Condition="$(HelixTargetQueue.Contains('Windows')) or $(HelixTargetQueue.Contains('windows'))">true</IsWindowsHelixQueue>
    <HelixTestName>$(MSBuildProjectName)/$(TargetFramework)</HelixTestName>
    <HelixUseArchive>false</HelixUseArchive>
    <LoggingTestingDisableFileLogging Condition="'$(IsHelixJob)' == 'true'">true</LoggingTestingDisableFileLogging>
    <NodeVersion>10.15.3</NodeVersion>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'">
    <HelixProjectPlatform Include="Windows" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' != '.NETFramework'">
    <HelixProjectPlatform Include="@(HelixAvailablePlatform)" />
  </ItemGroup>

  <ItemGroup>
    <HelixContent Include="$(RepoRoot)eng\helix\content\**\*" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnMssql)' == 'true' AND '$(IsWindowsHelixQueue)' == 'true'">
    <HelixPreCommand Include="call RunPowershell.cmd mssql\InstallSqlServerLocalDB.ps1 || exit /b 1" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnNode)' == 'true' AND '$(IsWindowsHelixQueue)' == 'false'">
    <HelixPreCommand Include="./installnode.sh $(NodeVersion) linux-x64" Condition="!($(HelixTargetQueue.Contains('OSX'))" />
    <HelixPreCommand Include="./installnode.sh $(NodeVersion) darwin-x64" Condition="$(HelixTargetQueue.Contains('OSX')" />
    <HelixPreCommand Include="export PATH=%24PATH&quot;:&quot;%24HELIX_CORRELATION_PAYLOAD/node/bin" />
  </ItemGroup>
  
  <ItemGroup Condition="'$(TestDependsOnNode)' == 'true' AND '$(IsWindowsHelixQueue)' == 'true'">
    <HelixPreCommand Include="call RunPowershell.cmd InstallNode.ps1 $(NodeVersion) %25HELIX_CORRELATION_PAYLOAD%25/node/bin || exit /b 1" />
    <HelixPreCommand Include="set PATH=%25PATH%25;%25HELIX_CORRELATION_PAYLOAD%25/node/bin" />
  </ItemGroup>

</Project>
